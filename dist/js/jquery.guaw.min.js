/*! GUAW: A GitHub User Activity Widget - v0.2.0 - 2014-06-29
* http://thebinarypenguin.github.io/guaw
* Copyright (c) 2014 Ethan Zimmerman; Licensed MIT */
!function(a){function b(b,d){this.container=a(b),this.widgetHead=null,this.widgetBody=null,this.settings=a.extend({},c,d),this.realTimeout=this.settings.timeout,this.init()}var c={username:"octocat",timeout:300,debug:!1},d={boilerplate:function(){return'<div class="guaw"><div class="guaw-head"></div><ul class="guaw-body"></ul><div class="guaw-foot"><a href="http://thebinarypenguin.github.io/guaw/">Powered by GUAW</a></div></div>'},profile:function(a){var b=a.avatar_url,c=a.name,d=a.login;return c?'<a href="https://github.com/'+d+'"><img src="'+b+'"></a><h4><a href="https://github.com/'+d+'">'+c+'</a></h4><small><a href="https://github.com/'+d+'">'+d+'</a></small><div class="clearfix"></div>':'<a href="https://github.com/'+d+'"><img src="'+b+'"></a><h4><a href="https://github.com/'+d+'">'+d+'</a></h4><div class="clearfix"></div>'},CommitCommentEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.comment.html_url,g=a.payload.comment.commit_id.substring(0,7);return'<li id="'+b+'" class="commit-comment list-group-item">Commented on commit <a href="'+f+'">'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},CreateEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.ref_type,g=a.payload.ref;return"repository"===f?'<li id="'+b+'" class="create list-group-item">Created '+f+' <a href="https://github.com/'+d+'">'+d+"</a> <small>"+e.date(a.created_at)+"</small></li>":"branch"===f||"tag"===f?'<li id="'+b+'" class="create list-group-item">Created '+f+' <a href="https://github.com/'+d+"/tree/"+g+'">'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>":void 0},DeleteEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.ref_type,g=a.payload.ref;return'<li id="'+b+'" class="delete list-group-item">Deleted '+f+" "+g+' at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},DownloadEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.download.name,g=a.payload.download.html_url;return'<li id="'+b+'" class="download list-group-item">Created download <a href="'+g+'">'+f+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},FollowEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.payload.target.login,f=a.payload.target.html_url;return'<li id="'+b+'" class="follow list-group-item">Started following <a href="'+f+'">'+d+"</a> <small>"+c+"</small></li>"},ForkApplyEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name;return'<li id="'+b+'" class="fork-apply list-group-item">Applied a patch to <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},ForkEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.forkee.full_name;return'<li id="'+b+'" class="fork list-group-item">Forked <a href="https://github.com/'+d+'">'+d+'</a> to <a href="https://github.com/'+f+'">'+f+"</a> <small>"+c+"</small></li>"},GistEvent:function(a){var b=a.id,c=e.date(a.created_at),d=e.capitalize(a.payload.action)+"d",f=a.payload.gist.id,g=a.payload.gist.html_url;return'<li id="'+b+'" class="gist list-group-item">'+d+' gist <a href="'+g+'">'+f+"</a> <small>"+c+"</small></li>"},GollumEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name;return'<li id="'+b+'" class="gollum list-group-item">Edited the wiki at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},IssueCommentEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=e.issueType(a.payload.issue),g=a.payload.issue.number,h=null;return h="pull request"===f?a.payload.issue.pull_request.html_url+"#issuecomment-"+a.payload.comment.id:a.payload.comment.html_url,'<li id="'+b+'" class="issue-comment list-group-item">Commented on '+f+' <a href="'+h+'">#'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},IssuesEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=e.capitalize(a.payload.action),g=a.payload.issue.number,h=a.payload.issue.html_url;return'<li id="'+b+'" class="issues list-group-item">'+f+' issue <a href="'+h+'">#'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},MemberEvent:function(a){var b=a.id,c=(e.date(a.created_at),a.repo.name),d=a.payload.member.login,f=a.payload.member.html_url;return'<li id="'+b+'" class="member list-group-item">Added <a href="'+f+'">'+d+'</a> to <a href="https://github.com/'+c+'">'+c+"</a> <small>"+e.date(a.created_at)+"</small></li>"},PublicEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name;return'<li id="'+b+'" class="public list-group-item">Open sourced repository <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},PullRequestEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=e.capitalize(a.payload.action);return pullRequestID=a.payload.number,'<li id="'+b+'" class="pull-request list-group-item">'+f+' pull request <a href="https://github.com/'+d+"/pull/"+pullRequestID+'">#'+pullRequestID+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},PullRequestReviewCommentEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.comment.html_url,g=e.tail(a.payload.comment.pull_request_url);return'<li id="'+b+'" class="pull-request-review-comment list-group-item">Commented on pull request <a href="'+f+'">#'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},PushEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=1===a.payload.size?"1 commit ":a.payload.size+" commits ",g=e.tail(a.payload.ref);return'<li id="'+b+'" class="push list-group-item">Pushed '+f+'to <a href="https://github.com/'+d+"/tree/"+g+'">'+g+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},ReleaseEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name,f=a.payload.release.name,g=a.payload.release.html_url;return'<li id="'+b+'" class="release list-group-item">Created release <a href="'+g+'">'+f+'</a> at <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"},WatchEvent:function(a){var b=a.id,c=e.date(a.created_at),d=a.repo.name;return'<li id="'+b+'" class="watch list-group-item">Starred repository <a href="https://github.com/'+d+'">'+d+"</a> <small>"+c+"</small></li>"}},e={capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},date:function(a){var b=new Date(a);return b.getMonth()+1+"-"+b.getDate()+"-"+b.getFullYear()},issueType:function(a){return a.pull_request&&a.pull_request.html_url&&a.pull_request.diff_url&&a.pull_request.patch_url?"pull request":"issue"},tail:function(a){return a.split("/").pop()}};a.extend(b.prototype,{init:function(){this.container.append(d.boilerplate()),this.widgetHead=this.container.find(".guaw-head"),this.widgetBody=this.container.find(".guaw-body"),this.settings.debug&&console.log("Settings: ",this.settings),this.poll()},poll:function(){this.fetchProfile().then(function(){return this.fetchActivityPage(1)}).then(function(){return this.fetchActivityPage(2)}).then(function(){return this.fetchActivityPage(3)}).then(function(){return this.fetchActivityPage(4)}).then(function(){return this.fetchActivityPage(5)}).then(function(){return this.fetchActivityPage(6)}).then(function(){return this.fetchActivityPage(7)}).then(function(){return this.fetchActivityPage(8)}).then(function(){return this.fetchActivityPage(9)}).then(function(){return this.fetchActivityPage(10)}).always(function(){setTimeout(a.proxy(this.poll,this),1e3*this.realTimeout)})},fetchProfile:function(){var b="https://api.github.com/users/"+this.settings.username,c=a.ajax({url:b,headers:{Accept:"application/vnd.github.v3+json"},dataType:"json",ifModified:!0,context:this});return c.done(function(a,c,e){this.settings.debug&&console.log("Fetch "+b+" ("+e.status+" "+e.statusText+")"),a&&this.widgetHead.html(d.profile(a))}),c.fail(function(a){this.settings.debug&&console.log("Fetch "+b+" ("+a.status+" "+a.statusText+")")}),c},fetchActivityPage:function(b){var c="https://api.github.com/users/"+this.settings.username+"/events/public?page="+b,e=a.ajax({url:c,headers:{Accept:"application/vnd.github.v3+json"},dataType:"json",ifModified:!0,context:this});return e.done(function(a,e,f){if(this.setRealTimeout(f.getResponseHeader("X-Poll-Interval")),this.settings.debug&&console.log("Fetch "+c+" ("+f.status+" "+f.statusText+")"),a){for(var g="",h=0;h<a.length;h++)d[a[h].type]&&(g+=d[a[h].type](a[h]));1===b&&this.widgetBody.html(""),this.widgetBody.append(g)}}),e.fail(function(a){this.setRealTimeout(a.getResponseHeader("X-Poll-Interval")),this.settings.debug&&console.log("Fetch "+c+" ("+a.status+" "+a.statusText+")")}),e},setRealTimeout:function(a){realTimeout=this.settings.timeout,a>realTimeout&&(realTimeout=a)}}),a.fn.guaw=function(c){return this.each(function(){a.data(this,"guaw_plugin")||a.data(this,"guaw_plugin",new b(this,c))}),this}}(jQuery,window,document);