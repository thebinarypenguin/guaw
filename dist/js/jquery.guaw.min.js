/*! GUAW: A GitHub User Activity Widget - v0.3.0 - 2014-06-30
* http://thebinarypenguin.github.io/guaw
* Copyright (c) 2014 Ethan Zimmerman; Licensed MIT */
!function(a){"use strict";function b(b,d){this.container=a(b),this.widgetHead=null,this.widgetBody=null,this.settings=a.extend({},c,d),this.realTimeout=this.settings.timeout,this.init()}var c={username:"octocat",timeout:300,debug:!1},d=function(){var a={capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},date:function(a){var b=new Date(a);return b.getMonth()+1+"-"+b.getDate()+"-"+b.getFullYear()},issueType:function(a){return a.pull_request&&a.pull_request.html_url&&a.pull_request.diff_url&&a.pull_request.patch_url?"pull request":"issue"},tail:function(a){return a.split("/").pop()}},b={boilerplate:function(){return'<div class="guaw"><div class="guaw-head"></div><ul class="guaw-body"></ul><div class="guaw-foot"><a href="http://thebinarypenguin.github.io/guaw/">Powered by GUAW</a></div></div>'},profileWithName:function(a){var b=a.avatar_url,c=a.name,d=a.login;return'<a href="https://github.com/'+d+'"><img src="'+b+'"></a><h4><a href="https://github.com/'+d+'">'+c+'</a></h4><small><a href="https://github.com/'+d+'">'+d+'</a></small><div class="clearfix"></div>'},profileWithoutName:function(a){var b=a.avatar_url,c=a.login;return'<a href="https://github.com/'+c+'"><img src="'+b+'"></a><h4><a href="https://github.com/'+c+'">'+c+'</a></h4><div class="clearfix"></div>'},commentOnCommit:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.comment.html_url,g=b.payload.comment.commit_id.substring(0,7);return'<li id="'+c+'" class="list-group-item">Commented on commit <a href="'+f+'">'+g+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},createRepository:function(b){{var c=b.id,d=a.date(b.created_at),e=b.repo.name;b.payload.ref}return'<li id="'+c+'" class="list-group-item">Created repository <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},createBranch:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.ref;return'<li id="'+c+'" class="list-group-item">Created branch <a href="https://github.com/'+e+"/tree/"+f+'">'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},createTag:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.ref;return'<li id="'+c+'" class="list-group-item">Created tag <a href="https://github.com/'+e+"/tree/"+f+'">'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},deleteBranch:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.ref;return'<li id="'+c+'" class="list-group-item">Deleted branch '+f+' at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},deleteTag:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.ref;return'<li id="'+c+'" class="list-group-item">Deleted tag '+f+' at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},createDownload:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.download.name,g=b.payload.download.html_url;return'<li id="'+c+'" class="list-group-item">Created download <a href="'+g+'">'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},followUser:function(b){var c=b.id,d=a.date(b.created_at),e=b.payload.target.login,f=b.payload.target.html_url;return'<li id="'+c+'" class="list-group-item">Started following <a href="'+f+'">'+e+"</a> <small>"+d+"</small></li>"},applyPatch:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name;return'<li id="'+c+'" class="list-group-item">Applied a patch to <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},forkRepository:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.forkee.full_name;return'<li id="'+c+'" class="list-group-item">Forked <a href="https://github.com/'+e+'">'+e+'</a> to <a href="https://github.com/'+f+'">'+f+"</a> <small>"+d+"</small></li>"},createGist:function(b){var c=b.id,d=a.date(b.created_at),e=b.payload.gist.id,f=b.payload.gist.html_url;return'<li id="'+c+'" class="list-group-item">Created gist <a href="'+f+'">'+e+"</a> <small>"+d+"</small></li>"},updateGist:function(b){var c=b.id,d=a.date(b.created_at),e=b.payload.gist.id,f=b.payload.gist.html_url;return'<li id="'+c+'" class="list-group-item">Updated gist <a href="'+f+'">'+e+"</a> <small>"+d+"</small></li>"},editWiki:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name;return'<li id="'+c+'" class="list-group-item">Edited the wiki at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},commentOnIssue:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.issue.number,g=b.payload.comment.html_url;return'<li id="'+c+'" class="list-group-item">Commented on issue <a href="'+g+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},commentOnPullRequest:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.issue.number,g=b.payload.issue.pull_request.html_url+"#issuecomment-"+b.payload.comment.id;return'<li id="'+c+'" class="list-group-item">Commented on pull request <a href="'+g+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},openIssue:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.issue.number,g=b.payload.issue.html_url;return'<li id="'+c+'" class="list-group-item">Opened issue <a href="'+g+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},closeIssue:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.issue.number,g=b.payload.issue.html_url;return'<li id="'+c+'" class="list-group-item">Closed issue <a href="'+g+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},reopenIssue:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.issue.number,g=b.payload.issue.html_url;return'<li id="'+c+'" class="list-group-item">Reopened issue <a href="'+g+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},addUserToRepository:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.member.login,g=b.payload.member.html_url;return'<li id="'+c+'" class="list-group-item">Added <a href="'+g+'">'+f+'</a> to <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},openSourceRepository:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name;return'<li id="'+c+'" class="list-group-item">Open sourced repository <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},openPullRequest:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.number;return'<li id="'+c+'" class="list-group-item">Opened pull request <a href="https://github.com/'+e+"/pull/"+f+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},closePullRequest:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.number;return'<li id="'+c+'" class="list-group-item">Closed pull request <a href="https://github.com/'+e+"/pull/"+f+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},reopenPullRequest:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.number;return'<li id="'+c+'" class="list-group-item">Reopened pull request <a href="https://github.com/'+e+"/pull/"+f+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},synchronizePullRequest:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.number;return'<li id="'+c+'" class="list-group-item">Synchronized pull request <a href="https://github.com/'+e+"/pull/"+f+'">#'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},commentOnPullRequestDiff:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.comment.html_url,g=a.tail(b.payload.comment.pull_request_url);return'<li id="'+c+'" class="list-group-item">Commented on pull request <a href="'+f+'">#'+g+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},pushToBranch:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=1===b.payload.size?"1 commit ":b.payload.size+" commits ",g=a.tail(b.payload.ref);return'<li id="'+c+'" class="list-group-item">Pushed '+f+'to <a href="https://github.com/'+e+"/tree/"+g+'">'+g+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},createRelease:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name,f=b.payload.release.name,g=b.payload.release.html_url;return'<li id="'+c+'" class="list-group-item">Created release <a href="'+g+'">'+f+'</a> at <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"},starRepository:function(b){var c=b.id,d=a.date(b.created_at),e=b.repo.name;return'<li id="'+c+'" class="list-group-item">Starred repository <a href="https://github.com/'+e+'">'+e+"</a> <small>"+d+"</small></li>"}},c=function(c,d){if("boilerplate"===c)return b.boilerplate();if("profile"===c)return d.name?b.profileWithName(d):b.profileWithoutName(d);if("event"===c){if("CommitCommentEvent"===d.type)return b.commentOnCommit(d);if("CreateEvent"===d.type&&"repository"===d.payload.ref_type)return b.createRepository(d);if("CreateEvent"===d.type&&"branch"===d.payload.ref_type)return b.createBranch(d);if("CreateEvent"===d.type&&"tag"===d.payload.ref_type)return b.createTag(d);if("DeleteEvent"===d.type&&"branch"===d.payload.ref_type)return b.deleteBranch(d);if("DeleteEvent"===d.type&&"tag"===d.payload.ref_type)return b.deleteTag(d);if("DownloadEvent"===d.type)return b.createDownload(d);if("FollowEvent"===d.type)return b.followUser(d);if("ForkApplyEvent"===d.type)return b.applyPatch(d);if("ForkEvent"===d.type)return b.forkRepository(d);if("GistEvent"===d.type&&"create"===d.payload.action)return b.createGist(d);if("GistEvent"===d.type&&"update"===d.payload.action)return b.updateGist(d);if("GollumEvent"===d.type)return b.editWiki(d);if("IssueCommentEvent"===d.type&&"issue"===a.issueType(d.payload.issue))return b.commentOnIssue(d);if("IssueCommentEvent"===d.type&&"pull request"===a.issueType(d.payload.issue))return b.commentOnPullRequest(d);if("IssuesEvent"===d.type&&"opened"===d.payload.action)return b.openIssue(d);if("IssuesEvent"===d.type&&"closed"===d.payload.action)return b.closeIssue(d);if("IssuesEvent"===d.type&&"reopened"===d.payload.action)return b.reopenIssue(d);if("MemberEvent"===d.type)return b.addUserToRepository(d);if("PublicEvent"===d.type)return b.openSourceRepository(d);if("PullRequestEvent"===d.type&&"opened"===d.payload.action)return b.openPullRequest(d);if("PullRequestEvent"===d.type&&"closed"===d.payload.action)return b.closePullRequest(d);if("PullRequestEvent"===d.type&&"reopened"===d.payload.action)return b.reopenPullRequest(d);if("PullRequestEvent"===d.type&&"synchronized"===d.payload.action)return b.synchronizePullRequest(d);if("PullRequestReviewCommentEvent"===d.type)return b.commentOnPullRequestDiff(d);if("PushEvent"===d.type)return b.pushToBranch(d);if("ReleaseEvent"===d.type)return b.createRelease(d);if("WatchEvent"===d.type)return b.starRepository(d)}};return{boilerplate:function(){return c("boilerplate")},profile:function(a){return c("profile",a)},event:function(a){return c("event",a)}}}();a.extend(b.prototype,{init:function(){this.container.append(d.boilerplate()),this.widgetHead=this.container.find(".guaw-head"),this.widgetBody=this.container.find(".guaw-body"),this.settings.debug&&console.log("Settings: ",this.settings),this.poll()},poll:function(){this.fetchProfile().then(function(){return this.fetchActivityPage(1)}).then(function(){return this.fetchActivityPage(2)}).then(function(){return this.fetchActivityPage(3)}).then(function(){return this.fetchActivityPage(4)}).then(function(){return this.fetchActivityPage(5)}).then(function(){return this.fetchActivityPage(6)}).then(function(){return this.fetchActivityPage(7)}).then(function(){return this.fetchActivityPage(8)}).then(function(){return this.fetchActivityPage(9)}).then(function(){return this.fetchActivityPage(10)}).always(function(){setTimeout(a.proxy(this.poll,this),1e3*this.realTimeout)})},fetchProfile:function(){var b="https://api.github.com/users/"+this.settings.username,c=a.ajax({url:b,headers:{Accept:"application/vnd.github.v3+json"},dataType:"json",ifModified:!0,context:this});return c.done(function(a,c,e){this.settings.debug&&console.log("Fetch "+b+" ("+e.status+" "+e.statusText+")"),a&&(this.settings.debug&&console.log(a),this.widgetHead.html(d.profile(a)))}),c.fail(function(a){this.settings.debug&&console.log("Fetch "+b+" ("+a.status+" "+a.statusText+")")}),c},fetchActivityPage:function(b){var c="https://api.github.com/users/"+this.settings.username+"/events/public?page="+b,e=a.ajax({url:c,headers:{Accept:"application/vnd.github.v3+json"},dataType:"json",ifModified:!0,context:this});return e.done(function(a,e,f){if(this.setRealTimeout(f.getResponseHeader("X-Poll-Interval")),this.settings.debug&&console.log("Fetch "+c+" ("+f.status+" "+f.statusText+")"),a){this.settings.debug&&console.log(a);for(var g="",h=0;h<a.length;h++)g+=d.event(a[h]);1===b&&this.widgetBody.html(""),this.widgetBody.append(g)}}),e.fail(function(a){this.setRealTimeout(a.getResponseHeader("X-Poll-Interval")),this.settings.debug&&console.log("Fetch "+c+" ("+a.status+" "+a.statusText+")")}),e},setRealTimeout:function(a){this.realTimeout=this.settings.timeout,a>this.realTimeout&&(this.realTimeout=a)}}),a.fn.guaw=function(c){return this.each(function(){a.data(this,"guaw_plugin")||a.data(this,"guaw_plugin",new b(this,c))}),this}}(jQuery,window,document);